<Project>
	<!-- NOTE: We should ONLY add workarounds to MtouchExtraArgs IF they have not already been set by the user's project -->
	<PropertyGroup>
		<!-- Debugger workaround https://github.com/dotnet/maui-samples/blob/8aa6b8780b12e97b157514c3bdc54bb4a13001cd/HelloMacCatalyst/HelloMacCatalyst.csproj#L7 -->
		<!-- <MtouchExtraArgs Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">$(MtouchExtraArgs) -setenv:MONO_THREADS_SUSPEND=preemptive</MtouchExtraArgs> -->
		<MtouchExtraArgs Condition="!$(MtouchExtraArgs.Contains('--setenv=MONO_GC_Params='))">$(MtouchExtraArgs) --setenv=MONO_GC_PARAMS=soft-heap-limit=512m,nursery-size=64m,evacuation-threshold=66,major=marksweep,concurrent-sweep</MtouchExtraArgs>

		<!-- See https://github.com/unoplatform/uno/issues/9430 for more details. -->
		<MtouchExtraArgs Condition="!$(MtouchExtraArgs.Contains('--registrar:'))">$(MtouchExtraArgs) --registrar:static</MtouchExtraArgs>
	</PropertyGroup>

	<Choose>
		<When Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">
			<PropertyGroup>
				<!-- Required for C# Hot Reload -->
				<UseInterpreter Condition="'$(Configuration)' == 'Debug'">True</UseInterpreter>

				<IPhoneResourcePrefix>$(iOSProjectFolder)Resources</IPhoneResourcePrefix>
				<CodesignEntitlements Condition=" Exists('$(iOSProjectFolder)Entitlements.plist') ">$(iOSProjectFolder)Entitlements.plist</CodesignEntitlements>
				<CodesignEntitlements Condition=" Exists('$(iOSProjectFolder)Entitlements-$(Configuration).plist') ">$(iOSProjectFolder)Entitlements-$(Configuration).plist</CodesignEntitlements>
				<_SingleProjectiOSExcludes>$(iOSProjectFolder)/**/.*/**</_SingleProjectiOSExcludes>
			</PropertyGroup>
		</When>
		<When Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">
			<PropertyGroup>
				<!-- Full globalization is required for Uno -->
				<InvariantGlobalization Condition="$(InvariantGlobalization) == ''">false</InvariantGlobalization>

				<IPhoneResourcePrefix>$(MacCatalystProjectFolder)Resources</IPhoneResourcePrefix>
				<CodesignEntitlements Condition=" Exists('$(MacCatalystProjectFolder)Entitlements.plist') ">$(MacCatalystProjectFolder)Entitlements.plist</CodesignEntitlements>
				<CodesignEntitlements Condition=" Exists('$(MacCatalystProjectFolder)Entitlements-$(Configuration).plist') ">$(MacCatalystProjectFolder)Entitlements-$(Configuration).plist</CodesignEntitlements>
				<_SingleProjectMacCatalystExcludes>$(MacCatalystProjectFolder)/**/.*/**</_SingleProjectMacCatalystExcludes>
			</PropertyGroup>
			<PropertyGroup Condition="'$(Configuration)'=='Release'">
				<!-- https://github.com/xamarin/xamarin-macios/issues/14812 -->
				<MtouchExtraArgs Condition="!$(MtouchExtraArgs.Contains('--marshal-objectivec-exceptions'))">$(MtouchExtraArgs) --marshal-objectivec-exceptions:disable</MtouchExtraArgs>
			</PropertyGroup>
			<When Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'macos'">
				<!--
					We aren't currently fully supporting macos because of
					https://github.com/xamarin/xamarin-macios/issues/16401
					https://github.com/dotnet/sdk/issues/21877
				-->
				<PropertyGroup>
					<TrimMode Condition="'$(Configuration)'=='Release'">link</TrimMode>
				</PropertyGroup>
			</When>
		</When>
	</Choose>
</Project>
